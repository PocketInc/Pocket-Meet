<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Start Meeting - ADMIN</title>
    <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>

</head>
<body>

<video id="video" hidden="hidden"></video>
<video id="video1"></video>
<script>// In the renderer process.
var peer = new Peer();


const { desktopCapturer, ipcRenderer } = require('electron')
let videoStream;
peer.on('open', function(id) {
    console.log('My peer ID is: ' + id);
    desktopCapturer.getSources({types: ['window', 'screen']}).then(async sources => {
        for (const source of sources) {
            if (source.name === 'Entire Screen') {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        audio: false,
                        video: {
                            mandatory: {
                                chromeMediaSource: 'desktop',
                                chromeMediaSourceId: source.id,
                                minWidth: 1280,
                                maxWidth: 1280,
                                minHeight: 720,
                                maxHeight: 720
                            }
                        }
                    })
                    handleStream(stream)
                } catch (e) {
                    handleError(e)
                }
                return
            }
        }
    })

    function handleStream(stream) {
        const video = document.querySelector('video')
        video.srcObject = stream
        video.onloadedmetadata = (e) => video.play()
        videoStream = stream;

    }

    function handleError(e) {
        console.log(e)
    }


    /*peer.on('call', function (call) {
        // Answer the call, providing our mediaStream
        call.answer(document.getElementById('video').srcObject);
        call.on('stream', function (stream) {
            console.log(stream)
        })
    });*/
    peer.on('connection',function (conn) {
        console.log("New Connection")
        conn.send('Hello!');
            // Receive messages
            conn.on('data', function(data) {
                console.log('Received', data);
            });
    })

})
peer.on('call', function(call) {
    // Answer the call, providing our mediaStream
    call.answer(document.getElementById('video').srcObject);
    call.on('stream',function (stream) {
        document.getElementById('video1').srcObject = stream
    })
});
</script>
</body>
</html>